---
title: Openmv
tags: [Openmv]
categories: [硬件]
---


Reference: [https://singtown.com/openmv/](https://singtown.com/openmv/)



### 颜色识别

```python
import sensor

sensor.reset()
sensor.set_pixformat(sensor.RGB565)
sensor.set_framesize(sensor.QVGA)
sensor.set_auto_gain(False)         # 颜色识别中，应关闭自动增益
sensor.set_auto_whitebal(False)     # 颜色识别中，应关闭白平衡
sensor.skip_frames(n = 100)

thresholds = (60, 77, 6, 15, 0, 21)

while True:

    img = sensor.snapshot()

    blobs = img.find_blobs([thresholds], area_threshold = 200, pixels_threshold = 200, merge = True)

    for blob in blobs:
        img.draw_rectangle(blob.rect())
        img.draw_cross(blob.cx(), blob.cy())
        print(blob.code())  # 颜色代码，用于识别不同颜色

```




### AprilTag标记追踪

把AprilTag标记贴到目标上，就可以在OpenMV上识别出这个标签的3D位置，id。推荐用TAG36H11。

```python
import sensor, time, math

sensor.reset()
sensor.set_pixformat(sensor.RGB565)
sensor.set_framesize(sensor.QQVGA)
sensor.set_auto_gain(False)
sensor.set_auto_whitebal(False)
sensor.skip_frames(n = 100)

clock = time.clock()

f_x = (2.8 / 3.984) * 160 # 默认值
f_y = (2.8 / 2.952) * 120 # 默认值
c_x = 160 * 0.5 # 默认值(image.w * 0.5)
c_y = 120 * 0.5 # 默认值(image.h * 0.5)


def degrees(rad):
    return (180 * rad) / math.pi

while True:
    clock.tick()

    img = sensor.snapshot()

    for tag in img.find_apriltags(fx=f_x, fy=f_y, cx=c_x, cy=c_y):
        img.draw_rectangle(tag.rect())
        img.draw_cross(tag.cx(), tag.cy())

        print_args = (tag.x_translation(), tag.y_translation(), tag.z_translation(), \
                      degrees(tag.x_rotation()), degrees(tag.y_rotation()), degrees(tag.z_rotation()), \
                      tag.id())

        # 打印位置信息和角度信息，位置信息没有单位，需要确认角度系数
        print("Tx: %f, Ty: %f, Tz: %f, Rx: %f, Ry: %f, Rz: %f, ID: %d" % print_args)

    print(clock.fps())

```


### 模板匹配